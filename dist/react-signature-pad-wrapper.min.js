"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var React=require("react"),React__default=_interopDefault(React),PropTypes=_interopDefault(require("prop-types"));function Point(t,e,i){this.x=t,this.y=e,this.time=i||(new Date).getTime()}function Bezier(t,e,i,n){this.startPoint=t,this.control1=e,this.control2=i,this.endPoint=n}function throttle(t,e,i){var n,o,a,r=null,s=0;i||(i={});var h=function(){s=!1===i.leading?0:Date.now(),r=null,a=t.apply(n,o),r||(n=o=null)};return function(){var u=Date.now();s||!1!==i.leading||(s=u);var c=e-(u-s);return n=this,o=arguments,c<=0||c>e?(r&&(clearTimeout(r),r=null),s=u,a=t.apply(n,o),r||(n=o=null)):r||!1===i.trailing||(r=setTimeout(h,c)),a}}function SignaturePad(t,e){var i=this,n=e||{};this.velocityFilterWeight=n.velocityFilterWeight||.7,this.minWidth=n.minWidth||.5,this.maxWidth=n.maxWidth||2.5,this.throttle="throttle"in n?n.throttle:16,this.minDistance="minDistance"in n?n.minDistance:5,this.throttle?this._strokeMoveUpdate=throttle(SignaturePad.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=SignaturePad.prototype._strokeUpdate,this.dotSize=n.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=n.penColor||"black",this.backgroundColor=n.backgroundColor||"rgba(0,0,0,0)",this.onBegin=n.onBegin,this.onEnd=n.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(i._mouseButtonDown=!0,i._strokeBegin(t))},this._handleMouseMove=function(t){i._mouseButtonDown&&i._strokeMoveUpdate(t)},this._handleMouseUp=function(t){1===t.which&&i._mouseButtonDown&&(i._mouseButtonDown=!1,i._strokeEnd(t))},this._handleTouchStart=function(t){if(1===t.targetTouches.length){var e=t.changedTouches[0];i._strokeBegin(e)}},this._handleTouchMove=function(t){t.preventDefault();var e=t.targetTouches[0];i._strokeMoveUpdate(e)},this._handleTouchEnd=function(t){t.target===i._canvas&&(t.preventDefault(),i._strokeEnd(t))},this.on()}Point.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},Point.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},Point.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},Bezier.prototype.length=function(){for(var t=0,e=void 0,i=void 0,n=0;n<=10;n+=1){var o=n/10,a=this._point(o,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this._point(o,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(n>0){var s=a-e,h=r-i;t+=Math.sqrt(s*s+h*h)}e=a,i=r}return t},Bezier.prototype._point=function(t,e,i,n,o){return e*(1-t)*(1-t)*(1-t)+3*i*(1-t)*(1-t)*t+3*n*(1-t)*t*t+o*t*t*t},SignaturePad.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0},SignaturePad.prototype.fromDataURL=function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new Image,o=i.ratio||window.devicePixelRatio||1,a=i.width||this._canvas.width/o,r=i.height||this._canvas.height/o;this._reset(),n.src=t,n.onload=function(){e._ctx.drawImage(n,0,0,a,r)},this._isEmpty=!1},SignaturePad.prototype.toDataURL=function(t){var e;switch(t){case"image/svg+xml":return this._toSVG();default:for(var i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return(e=this._canvas).toDataURL.apply(e,[t].concat(n))}},SignaturePad.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},SignaturePad.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},SignaturePad.prototype.isEmpty=function(){return this._isEmpty},SignaturePad.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},SignaturePad.prototype._strokeUpdate=function(t){var e=t.clientX,i=t.clientY,n=this._createPoint(e,i),o=this._data[this._data.length-1],a=o&&o[o.length-1],r=a&&n.distanceTo(a)<this.minDistance;if(!a||!r){var s=this._addPoint(n),h=s.curve,u=s.widths;h&&u&&this._drawCurve(h,u.start,u.end),this._data&&this._data[this._data.length-1]||(this._data=[[]]),this._data[this._data.length-1].push({x:n.x,y:n.y,time:n.time,color:this.penColor})}},SignaturePad.prototype._strokeEnd=function(t){var e=this.points.length>2,i=this.points[0];if(!e&&i&&this._drawDot(i),i){var n=this._data[this._data.length-1],o=n[n.length-1];i.equals(o)||n.push({x:i.x,y:i.y,time:i.time,color:this.penColor})}"function"==typeof this.onEnd&&this.onEnd(t)},SignaturePad.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},SignaturePad.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},SignaturePad.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},SignaturePad.prototype._createPoint=function(t,e,i){var n=this._canvas.getBoundingClientRect();return new Point(t-n.left,e-n.top,i||(new Date).getTime())},SignaturePad.prototype._addPoint=function(t){var e=this.points;if(e.push(t),e.length>2){3===e.length&&e.unshift(e[0]);var i=this._calculateCurveControlPoints(e[0],e[1],e[2]).c2,n=this._calculateCurveControlPoints(e[1],e[2],e[3]).c1,o=new Bezier(e[1],i,n,e[2]),a=this._calculateCurveWidths(o);return e.shift(),{curve:o,widths:a}}return{}},SignaturePad.prototype._calculateCurveControlPoints=function(t,e,i){var n=t.x-e.x,o=t.y-e.y,a=e.x-i.x,r=e.y-i.y,s=(t.x+e.x)/2,h=(t.y+e.y)/2,u=(e.x+i.x)/2,c=(e.y+i.y)/2,d=Math.sqrt(n*n+o*o),l=Math.sqrt(a*a+r*r),p=l/(d+l),v=u+(s-u)*p,f=c+(h-c)*p,_=e.x-v,g=e.y-f;return{c1:new Point(s+_,h+g),c2:new Point(u+_,c+g)}},SignaturePad.prototype._calculateCurveWidths=function(t){var e=t.startPoint,i=t.endPoint,n={start:null,end:null},o=this.velocityFilterWeight*i.velocityFrom(e)+(1-this.velocityFilterWeight)*this._lastVelocity,a=this._strokeWidth(o);return n.start=this._lastWidth,n.end=a,this._lastVelocity=o,this._lastWidth=a,n},SignaturePad.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},SignaturePad.prototype._drawPoint=function(t,e,i){var n=this._ctx;n.moveTo(t,e),n.arc(t,e,i,0,2*Math.PI,!1),this._isEmpty=!1},SignaturePad.prototype._drawCurve=function(t,e,i){var n=this._ctx,o=i-e,a=Math.floor(t.length());n.beginPath();for(var r=0;r<a;r+=1){var s=r/a,h=s*s,u=h*s,c=1-s,d=c*c,l=d*c,p=l*t.startPoint.x;p+=3*d*s*t.control1.x,p+=3*c*h*t.control2.x,p+=u*t.endPoint.x;var v=l*t.startPoint.y;v+=3*d*s*t.control1.y,v+=3*c*h*t.control2.y,v+=u*t.endPoint.y;var f=e+u*o;this._drawPoint(p,v,f)}n.closePath(),n.fill()},SignaturePad.prototype._drawDot=function(t){var e=this._ctx,i="function"==typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,i),e.closePath(),e.fill()},SignaturePad.prototype._fromData=function(t,e,i){for(var n=0;n<t.length;n+=1){var o=t[n];if(o.length>1)for(var a=0;a<o.length;a+=1){var r=o[a],s=new Point(r.x,r.y,r.time),h=r.color;if(0===a)this.penColor=h,this._reset(),this._addPoint(s);else if(a!==o.length-1){var u=this._addPoint(s),c=u.curve,d=u.widths;c&&d&&e(c,d,h)}}else this._reset(),i(o[0])}},SignaturePad.prototype._toSVG=function(){var t=this,e=this._data,i=this._canvas,n=Math.max(window.devicePixelRatio||1,1),o=i.width/n,a=i.height/n,r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS(null,"width",i.width),r.setAttributeNS(null,"height",i.height),this._fromData(e,function(t,e,i){var n=document.createElement("path");if(!(isNaN(t.control1.x)||isNaN(t.control1.y)||isNaN(t.control2.x)||isNaN(t.control2.y))){var o="M "+t.startPoint.x.toFixed(3)+","+t.startPoint.y.toFixed(3)+" C "+t.control1.x.toFixed(3)+","+t.control1.y.toFixed(3)+" "+t.control2.x.toFixed(3)+","+t.control2.y.toFixed(3)+" "+t.endPoint.x.toFixed(3)+","+t.endPoint.y.toFixed(3);n.setAttribute("d",o),n.setAttribute("stroke-width",(2.25*e.end).toFixed(3)),n.setAttribute("stroke",i),n.setAttribute("fill","none"),n.setAttribute("stroke-linecap","round"),r.appendChild(n)}},function(e){var i=document.createElement("circle"),n="function"==typeof t.dotSize?t.dotSize():t.dotSize;i.setAttribute("r",n),i.setAttribute("cx",e.x),i.setAttribute("cy",e.y),i.setAttribute("fill",e.color),r.appendChild(i)});var s='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+o+" "+a+'" width="'+o+'" height="'+a+'">',h=r.innerHTML;if(void 0===h){var u=document.createElement("dummy"),c=r.childNodes;u.innerHTML="";for(var d=0;d<c.length;d+=1)u.appendChild(c[d].cloneNode(!0));h=u.innerHTML}return"data:image/svg+xml;base64,"+btoa(s+h+"</svg>")},SignaturePad.prototype.fromData=function(t){var e=this;this.clear(),this._fromData(t,function(t,i){return e._drawCurve(t,i.start,i.end)},function(t){return e._drawDot(t)}),this._data=t||[]},SignaturePad.prototype.toData=function(){return this._data};var throttle$1=function(t,e,i,n){var o,a=0;return"boolean"!=typeof e&&(n=i,i=e,e=void 0),function(){var r=this,s=Number(new Date)-a,h=arguments;function u(){a=Number(new Date),i.apply(r,h)}n&&!o&&u(),o&&clearTimeout(o),void 0===n&&s>t?u():!0!==e&&(o=setTimeout(n?function(){o=void 0}:u,void 0===n?t-s:t))}},throttle$2=Object.freeze({default:throttle$1,__moduleExports:throttle$1}),throttle$3=throttle$2&&throttle$1||throttle$2,debounce=function(t,e,i){return void 0===i?throttle$3(t,e,!1):throttle$3(t,i,!1!==e)},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},SignaturePad$1=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={canvasWidth:0,canvasHeight:0},i._callResizeHandler=debounce(i.props.debounceInterval,i.handleResize.bind(i)),i}return inherits(e,t),createClass(e,[{key:"componentDidMount",value:function(){this._canvas&&(this.props.width&&this.props.height||(this._canvas.style.width="100%"),this.scaleCanvas(),this.props.width&&this.props.height||window.addEventListener("resize",this._callResizeHandler),this._signaturePad=new SignaturePad(this._canvas,this.props.options))}},{key:"componentWillUnmount",value:function(){this.props.width&&this.props.height||window.removeEventListener("resize",this._callResizeHandler),this._signaturePad.off()}},{key:"isEmpty",value:function(){return this._signaturePad.isEmpty()}},{key:"clear",value:function(){this._signaturePad.clear()}},{key:"fromDataURL",value:function(t){this._signaturePad.fromDataURL(t)}},{key:"toDataURL",value:function(t){return this._signaturePad.toDataURL(t)}},{key:"fromData",value:function(t){this._signaturePad.fromData(t)}},{key:"toData",value:function(){return this._signaturePad.toData()}},{key:"off",value:function(){this._signaturePad.off()}},{key:"on",value:function(){this._signaturePad.on()}},{key:"handleResize",value:function(){this.scaleCanvas()}},{key:"scaleCanvas",value:function(){var t=Math.max(window.devicePixelRatio||1,1),e=(this.props.width||this._canvas.offsetWidth)*t,i=(this.props.height||this._canvas.offsetHeight)*t,n=this.state,o=n.canvasWidth,a=n.canvasHeight;if(e!==o||i!==a){var r=void 0;this.props.redrawOnResize&&this._signaturePad&&(r=this._signaturePad.toDataURL()),this._canvas.width=e,this._canvas.height=i,this.setState({canvasWidth:e,canvasHeight:i}),this._canvas.getContext("2d").scale(t,t),this.props.redrawOnResize&&this._signaturePad?this._signaturePad.fromDataURL(r):this._signaturePad&&this._signaturePad.clear()}}},{key:"render",value:function(){var t=this,e=this.props.canvasProps;return React__default.createElement("canvas",_extends({ref:function(e){return t._canvas=e}},e))}},{key:"instance",get:function(){return this._signaturePad}},{key:"canvas",get:function(){return this._canvas}},{key:"dotSize",set:function(t){this._signaturePad.dotSize=t},get:function(){return this._signaturePad.dotSize}},{key:"minWidth",set:function(t){this._signaturePad.minWidth=t},get:function(){return this._signaturePad.minWidth}},{key:"maxWidth",set:function(t){this._signaturePad.maxWidth=t},get:function(){return this._signaturePad.maxWidth}},{key:"throttle",set:function(t){this._signaturePad.throttle=t},get:function(){return this._signaturePad.throttle}},{key:"backgroundColor",set:function(t){this._signaturePad.backgroundColor=t},get:function(){return this._signaturePad.backgroundColor}},{key:"penColor",set:function(t){this._signaturePad.penColor=t},get:function(){return this._signaturePad.penColor}},{key:"velocityFilterWeight",set:function(t){this._signaturePad.velocityFilterWeight=t},get:function(){return this._signaturePad.velocityFilterWeight}},{key:"onBegin",set:function(t){if(!t||"function"!=typeof t)throw new Error("Invalid argument passed to onBegin()");this._signaturePad.onBegin=t}},{key:"onEnd",set:function(t){if(!t||"function"!=typeof t)throw new Error("Invalid argument passed to onEnd()");this._signaturePad.onEnd=t}}]),e}(React.PureComponent);SignaturePad$1.displayName="react-signature-pad-wrapper",SignaturePad$1.propTypes={width:PropTypes.number,height:PropTypes.number,options:PropTypes.object,redrawOnResize:PropTypes.bool.isRequired,debounceInterval:PropTypes.number.isRequired,canvasProps:PropTypes.object},SignaturePad$1.defaultProps={redrawOnResize:!1,debounceInterval:150},module.exports=SignaturePad$1;
//# sourceMappingURL=react-signature-pad-wrapper.min.js.map
